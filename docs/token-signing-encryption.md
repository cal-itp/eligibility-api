# Token signing and encryption

The Eligiblity Verification API makes use of Signed and Encrypted JSON Web Tokens (JWS, JWE, JWT) as a means of data transfer.

A public/private keypair must be generated by each party (Benefits Client and Eligibility Verification Server).
[Example keys](https://github.com/cal-itp/benefits/tree/dev/localhost/keys) are included for the test verification server
and sample agencies.

## Generating new keypairs

Using a terminal like `bash`, and the `openssl` program:

```bash
openssl genrsa -out [file name].key 2048
```

## Extract the public key

```bash
openssl rsa -in [private key created above].key -pubout > [file name].pub
```

There are two new files:

* `[file name].key`: private key in PEM format, apply to a `TransitAgency` instance in Django
* `[file name].pub`: public key in PEM format, give to the Eligibility Verification server

A public key in PEM format from the Eligibility Verification server is also required, and must be applied to an
`EligiblityVerifier` instance in Django.

## Format for config file

To get a single-line version of a PEM key, suitable for a JSON configuration file:

```bash
awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' <your PEM file here>
```
